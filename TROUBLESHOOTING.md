# GitHub Actions 故障排除指南

## 🔍 如何查看错误信息

### 1. 查看工作流运行日志

1. 进入 GitHub 仓库
2. 点击 **Actions** 标签页
3. 点击失败的工作流运行
4. 点击失败的 job（红色 ❌）
5. 展开失败的步骤查看详细错误信息

### 2. 常见问题

#### 问题 1: Job 被跳过（显示为灰色）

**原因：** 条件判断不满足，job 被跳过

**解决方案：**
- 检查 `if` 条件是否正确
- 手动触发时，确保选择了正确的平台选项
- 查看调试信息步骤的输出

#### 问题 2: 构建失败但没有错误信息

**可能原因：**
1. 依赖安装失败（静默失败）
2. PyInstaller 构建失败
3. 文件复制失败

**解决方案：**
1. 查看每个步骤的日志
2. 检查 "安装 Python 依赖" 步骤
3. 检查 "构建可执行文件" 步骤
4. 查看 "检查构建产物" 步骤

#### 问题 3: 找不到构建产物

**错误信息：** `dist/auto-login.exe 不存在` 或 `dist/auto-login 不存在`

**可能原因：**
- PyInstaller 构建失败
- 构建过程中出错但未报错

**解决方案：**
1. 查看 PyInstaller 的完整输出
2. 检查是否有隐藏导入缺失
3. 尝试添加更多调试信息

#### 问题 4: 条件判断错误

**症状：** 所有 job 都被跳过

**解决方案：**
- 检查 `if` 条件的语法
- 确保手动触发时输入了正确的值
- 使用简化版工作流（`build-simple.yml`）

## 🛠️ 调试步骤

### 步骤 1: 添加调试信息

工作流已包含调试步骤，会输出：
- 事件类型
- 平台选择
- 矩阵配置

### 步骤 2: 检查依赖安装

查看 "安装 Python 依赖" 步骤的输出，确认：
- pip 升级成功
- requirements.txt 中的依赖都安装成功
- PyInstaller 安装成功

### 步骤 3: 检查构建过程

查看 "构建可执行文件" 步骤的输出，确认：
- PyInstaller 命令执行成功
- 没有警告或错误
- 构建完成

### 步骤 4: 验证构建产物

查看 "检查构建产物" 步骤的输出，确认：
- dist 目录存在
- 可执行文件已生成
- 文件大小正常（不应为 0）

## 🔧 快速修复

### 修复 1: 使用简化版工作流

如果主工作流有问题，可以使用简化版：

1. 将 `.github/workflows/build-simple.yml` 设为默认
2. 或重命名文件，让 GitHub 使用简化版

### 修复 2: 简化条件判断

如果条件判断有问题，可以：

1. 暂时移除 `if` 条件，让所有 job 都运行
2. 测试通过后，再添加条件

### 修复 3: 添加错误处理

在每个关键步骤添加错误处理：

```yaml
- name: 构建可执行文件
  run: |
    set -e  # 遇到错误立即退出
    pyinstaller ...
```

## 📋 检查清单

运行前检查：

- [ ] 工作流文件语法正确（YAML 格式）
- [ ] 所有必需的文件都存在（main.py, requirements.txt 等）
- [ ] 依赖版本兼容
- [ ] 条件判断逻辑正确

## 🆘 获取帮助

如果问题仍然存在：

1. **查看完整日志**：展开所有步骤，查看详细输出
2. **检查 GitHub Actions 限制**：
   - 免费账户有运行时间限制
   - 检查是否超出配额
3. **尝试本地构建**：使用 `build.py` 在本地测试
4. **简化测试**：创建一个最小的工作流测试

## 📝 常见错误信息

### "No such file or directory"
- 检查文件路径是否正确
- 确认文件已提交到仓库

### "Command failed with exit code 1"
- 查看命令的完整输出
- 检查依赖是否正确安装

### "Artifact upload failed"
- 检查文件是否存在
- 确认文件大小未超出限制（10GB）

### "Workflow run failed"
- 查看所有 job 的状态
- 检查是否有 job 被跳过或失败
